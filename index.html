<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>USB Thermal Printer Test</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <h2>ğŸ–¨ï¸ USB Thermal Printer Test</h2>
    <button id="print">Connect & Print</button>

    <pre id="log"></pre>

    <script>
      const log = (msg) => {
        document.getElementById("log").textContent += msg + "\n";
      };

      document.getElementById("print").onclick = async () => {
        try {
          log("Requesting USB device...");

          const device = await navigator.usb.requestDevice({
            filters: [], // allow user to pick printer
          });

          log(`Selected device: ${device.productName}`);

          await device.open();

          if (device.configuration === null) {
            await device.selectConfiguration(1);
          }

          await device.claimInterface(0);
          log("Interface claimed");

          // ESC/POS Modern Receipt Design
          const encoder = new TextEncoder();

          const ESC = 0x1b;
          const GS = 0x1d;

          const data = new Uint8Array([
            // Init
            ESC,
            0x40,

            // ================= HEADER =================
            ESC,
            0x61,
            0x01, // Center
            ESC,
            0x45,
            0x01, // Bold ON
            GS,
            0x21,
            0x22, // Quad size
            ...encoder.encode("MICROBLADE\n"),
            GS,
            0x21,
            0x00,
            ESC,
            0x45,
            0x00,
            ...encoder.encode("Electronics Store\n"),
            ...encoder.encode("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n"),

            // ================= META =================
            ESC,
            0x61,
            0x00, // Left
            ...encoder.encode("Invoice #: 000124\n"),
            ...encoder.encode("Date     : 2026-02-19\n"),
            ...encoder.encode("Cashier  : Admin\n"),
            ...encoder.encode("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"),

            // ================= ITEMS HEADER =================
            ESC,
            0x45,
            0x01,
            ...encoder.encode("ITEM            QTY   PRICE\n"),
            ESC,
            0x45,
            0x00,
            ...encoder.encode("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"),

            // ================= ITEMS =================
            ...encoder.encode("USB-C Cable        1     8.00\n"),
            ...encoder.encode("Wireless Mouse    1    15.50\n"),
            ...encoder.encode("Mechanical KB     1    45.00\n"),
            ...encoder.encode("Power Bank 20k    1    32.00\n"),
            ...encoder.encode("HDMI Adapter      1     6.50\n"),

            ...encoder.encode("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"),

            // ================= TOTALS =================
            ...encoder.encode("Subtotal               107.00\n"),
            ...encoder.encode("VAT (15%)               16.05\n"),

            ESC,
            0x45,
            0x01,
            ...encoder.encode("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"),
            ...encoder.encode("TOTAL                  123.05\n"),
            ESC,
            0x45,
            0x00,

            // ================= FOOTER =================
            ESC,
            0x61,
            0x01,
            ...encoder.encode("\nThank you for your purchase!\n"),
            ...encoder.encode("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"),
            ...encoder.encode("www.nilevalleylab.com\n"),
            ...encoder.encode("Designed & Developed by\n"),
            ESC,
            0x45,
            0x01,
            ...encoder.encode("Nile Valley Lab\n"),
            ESC,
            0x45,
            0x00,
            ...encoder.encode("0702 322 095\n\n"),

            // ================= CUT =================
            GS,
            0x56,
            0x41,
            0x10,
          ]);

          // // ESC/POS print data
          // const encoder = new TextEncoder();

          // const ESC = 0x1b;
          // const GS = 0x1d;

          // const data = new Uint8Array([
          //   // Initialize
          //   ESC,
          //   0x40,

          //   // Center + Bold + Double size (logo)
          //   ESC,
          //   0x61,
          //   0x01, // Center
          //   ESC,
          //   0x45,
          //   0x01, // Bold ON
          //   GS,
          //   0x21,
          //   0x11, // Double width + height
          //   ...encoder.encode("MICROBLADE SYS\n"),

          //   // Normal size
          //   GS,
          //   0x21,
          //   0x00,
          //   ESC,
          //   0x45,
          //   0x00, // Bold OFF
          //   ...encoder.encode("Electronics Store\n\n"),

          //   // Separator
          //   ESC,
          //   0x61,
          //   0x00, // Left align
          //   ...encoder.encode("--------------------------------\n"),

          //   // Items
          //   ...encoder.encode("USB-C Cable        8.00\n"),
          //   ...encoder.encode("Wireless Mouse    15.50\n"),
          //   ...encoder.encode("Mechanical KB     45.00\n"),
          //   ...encoder.encode("Power Bank 20k    32.00\n"),
          //   ...encoder.encode("HDMI Adapter       6.50\n"),

          //   ...encoder.encode("--------------------------------\n"),

          //   // Totals (bold)
          //   ESC,
          //   0x45,
          //   0x01,
          //   ...encoder.encode("Subtotal         107.00\n"),
          //   ...encoder.encode("VAT (15%)         16.05\n"),
          //   ...encoder.encode("--------------------------------\n"),
          //   ...encoder.encode("TOTAL            123.05\n"),
          //   ESC,
          //   0x45,
          //   0x00,

          //   // Footer
          //   ESC,
          //   0x61,
          //   0x01, // Center align
          //   ...encoder.encode("\nThank you!\n"),
          //   ...encoder.encode("www.nilevalleylab.com\n"),
          //   ...encoder.encode("Designed & Developed by\n"),
          //   ...encoder.encode("Nile Valley Lab\n"),
          //   ...encoder.encode("0702322095\n\n"),

          //   // Cut paper
          //   GS,
          //   0x56,
          //   0x41,
          //   0x10,
          // ]);

          // Endpoint is usually 1 (OUT)
          await device.transferOut(1, data);

          log("âœ… Print data sent");

          await device.close();
        } catch (err) {
          console.error(err);
          log("âŒ ERROR: " + err.message);
        }
      };
    </script>
  </body>
</html>
